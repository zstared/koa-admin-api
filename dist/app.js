'use strict';var _koa=require('koa'),_koa2=_interopRequireDefault(_koa),_path=require('path'),_path2=_interopRequireDefault(_path),_koaBody=require('koa-body'),_koaBody2=_interopRequireDefault(_koaBody),_koa2Cors=require('koa2-cors'),_koa2Cors2=_interopRequireDefault(_koa2Cors),_koaStatic=require('koa-static'),_koaStatic2=_interopRequireDefault(_koaStatic),_boot=require('./boot'),_boot2=_interopRequireDefault(_boot),_https=require('https'),_https2=_interopRequireDefault(_https),_fs=require('fs'),_fs2=_interopRequireDefault(_fs),_config=require('./config'),_config2=_interopRequireDefault(_config),_authentication=require('./middleware/authentication'),_authentication2=_interopRequireDefault(_authentication),_exception=require('./middleware/exception'),_exception2=_interopRequireDefault(_exception),_operation_log=require('./middleware/operation_log'),_operation_log2=_interopRequireDefault(_operation_log),_enum=require('./lib/enum.js');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}const router=require('./router/index.js'),app=new _koa2.default;app.use((0,_koa2Cors2.default)()),app.use((0,_koaStatic2.default)(_path2.default.join(__dirname,'../public/static'))),app.use((0,_koaStatic2.default)(_path2.default.join(__dirname,'../public/upload'))),app.use((0,_koaBody2.default)({multipart:!0,formidable:{multiples:!0,maxFileSize:_config2.default.uploadFileLimit}})),app.use(_exception2.default),app.use(_authentication2.default),app.use(_operation_log2.default),app.use(router.routes()),app.use(async a=>{a.error(_enum.RCode.common.C1000003,`请求地址[${a.URL}]有误!`)}),process.on('unhandledRejection',(a,b)=>{console.log('Unhandled Rejection at: Promise',b,'reason:',a)});const httpsOption={key:_fs2.default.readFileSync(_path2.default.join(__dirname,'../cert/2184091_www.zhengxinhong.top.key')),cert:_fs2.default.readFileSync(_path2.default.join(__dirname,'../cert/2184091_www.zhengxinhong.top.crt'))},server=_https2.default.createServer(httpsOption,app.callback()).listen(_config2.default.port,()=>{console.log(`WebAPI服务已启动!监听端口${_config2.default.port}...`),_boot2.default.init()});module.exports=server;